<!-- home/index.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Home - Golden Trash{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
{% endblock %}

{% block content %}
<!-- Search Section -->
<div class="search-section">
    <div class="search-container">
        <form method="get" action="{% url 'home:index' %}">
            <div class="search-input-wrapper">
                 <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" name="search" placeholder="Cari jenis sampah..." value="{{ keyword }}">
            </div>
        </form>
        {% if keyword %}
        <button class="filter-btn" id="filterBtn" style="background-color: red;">
            <i class="fas fa-filter"></i>
            <span>Filter</span>
        </button>
        {% endif %}
    </div>
</div>

<div id="filterPanel" class="hidden" style="padding: 1rem; border: 1px solid #ddd; border-radius: 10px; margin-top: 1rem;">
    <h3 style="margin-bottom: 1rem;">Filter</h3>

    <!-- Kategori -->
    <div style="margin-bottom: 1rem;">
        <strong>Kategori:</strong><br>
        {% for option in kategori_options %}
            <button class="filter-tag" data-filter-type="category" data-value="{{ option }}">{{ option|capfirst }}</button>
        {% endfor %}
    </div>

    <!-- Material -->
    <div style="margin-bottom: 1rem;">
        <strong>Material:</strong><br>
        {% for option in material_options %}
            <button class="filter-tag" data-filter-type="material" data-value="{{ option }}">{{ option|capfirst }}</button>
        {% endfor %}
    </div>

    <!-- Durasi -->
    <div style="margin-bottom: 1rem;">
        <strong>Durasi Pembuatan:</strong><br>
        <button class="filter-tag" data-filter-type="durasi" data-value="<1h">&lt; 1 Hari</button>
        <button class="filter-tag" data-filter-type="durasi" data-value="1h">1 Hari</button>
        <button class="filter-tag" data-filter-type="durasi" data-value=">1h">&gt; 1 Hari</button>
    </div>

    <!-- Kesulitan -->
    <div style="margin-bottom: 1rem;">
        <strong>Tingkat Kesulitan:</strong><br>
        <button class="filter-tag" style="background-color: green;" data-filter-type="difficulty" data-value="mudah">Mudah</button>
        <button class="filter-tag" style="background-color: orange;" data-filter-type="difficulty" data-value="standar">Standar</button>
        <button class="filter-tag" style="background-color: red;" data-filter-type="difficulty" data-value="sulit">Susah</button>
    </div>
</div>

<!-- Quick Actions -->
<div class="quick-actions">
    <button class="quick-action-btn" onclick="showAllItems()">
        <i class="fas fa-eye"></i>
        <span>Lihat Semua</span>
    </button>
    <a href="{% url 'home:index' %}" class="quick-action-btn">
    <i class="fas fa-times"></i>
    <span>Reset Pencarian</span>
    </a>
    <button class="quick-action-btn" onclick="toggleView()">
        <i class="fas fa-th"></i>
        <span>Ubah Tampilan</span>
    </button>
</div>

<!-- Category Tabs -->
<div class="category-tabs">
    <button class="tab-btn active" data-category="all">
        <i class="fas fa-globe"></i>
        <span>Semua</span>
    </button>
    <button class="tab-btn" data-category="non-organic">
        <i class="fas fa-bottle-water"></i>
        <span>Non-Organik</span>
    </button>
    <button class="tab-btn" data-category="organic">
        <i class="fas fa-leaf"></i>
        <span>Organik</span>
    </button>
    <button class="tab-btn" data-category="hazardous">
        <i class="fas fa-exclamation-triangle"></i>
        <span>B3</span>
    </button>
</div>

<!-- Hasil Pencarian Produk -->
{% if products %}
<h2>Hasil Pencarian</h2>
<div class="items-grid">
  {% for product in products %}
  <div class="item-card">
    <div class="item-icon">
      <img src="{{ product.image.url }}" alt="{{ product.title }}">
    </div>
    <div class="item-name">{{ product.title }}</div>
    <div class="item-description">{{ product.materials|truncatewords:10 }}</div>
  </div>
  {% endfor %}
</div>
{% elif keyword %}
<div class="no-results">
  <h3>Tidak ditemukan hasil untuk "{{ keyword }}"</h3>
</div>
{% endif %}

<!-- Items Grid -->
<div class="items-grid" id="itemsGrid">
    <!-- Non-Organic Items -->
    {% for waste in non_organic_wastes %}
    <div class="item-card" data-category="non-organic" data-name="{{ waste.name|lower }}">
        {% if waste.is_new %}
        <div class="item-badge new">Baru</div>
        {% endif %}
        <div class="item-icon">
            <img src="{% static 'images/'|add:waste.name|lower|add:'.png' %}" alt="{{ waste.name }}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-recycle" style="display:none; font-size: 2rem; color: #3498db;"></i>
        </div>
        <div class="item-name">{{ waste.name }}</div>
        <div class="item-description">{{ waste.description|truncatewords:10 }}</div>
    </div>
    {% empty %}
    <!-- Default Non-Organic Items if no data in database -->
<a href="/katalog/plastik/" style="text-decoration: none; color: inherit;">
    <div class="item-card" data-category="non-organic" data-name="plastik">
        <div class="item-icon">
            <img src="{% static 'images/plastik.png' %}" alt="Plastik"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-bottle-water" style="display:none; font-size: 2rem; color: #3498db;"></i>
        </div>
        <div class="item-name">Plastik</div>
        <div class="item-description">Botol, kemasan, dan wadah plastik</div>
    </div>
</a>


    <div class="item-card" data-category="non-organic" data-name="kertas">
        <div class="item-icon">
            <img src="{% static 'images/kertas.png' %}" alt="Kertas" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-file-alt" style="display:none; font-size: 2rem; color: #e74c3c;"></i>
        </div>
        <div class="item-name">Kertas</div>
        <div class="item-description">Kertas bekas, koran, majalah</div>
    </div>

    <div class="item-card" data-category="non-organic" data-name="logam">
        <div class="item-icon">
            <img src="{% static 'images/logam.png' %}" alt="Logam" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-cog" style="display:none; font-size: 2rem; color: #95a5a6;"></i>
        </div>
        <div class="item-name">Logam</div>
        <div class="item-description">Kaleng, besi, aluminium</div>
    </div>

    <div class="item-card" data-category="non-organic" data-name="kaca">
        <div class="item-icon">
            <img src="{% static 'images/kaca.png' %}" alt="Kaca" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-wine-bottle" style="display:none; font-size: 2rem; color: #16a085;"></i>
        </div>
        <div class="item-name">Kaca</div>
        <div class="item-description">Botol kaca, pecahan kaca</div>
    </div>

    <div class="item-card" data-category="non-organic" data-name="kain">
        <div class="item-icon">
            <img src="{% static 'images/kain.png' %}" alt="Kain" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-tshirt" style="display:none; font-size: 2rem; color: #9b59b6;"></i>
        </div>
        <div class="item-name">Kain</div>
        <div class="item-description">Pakaian bekas, kain perca</div>
    </div>

    <div class="item-card" data-category="non-organic" data-name="karet">
        <div class="item-icon">
            <img src="{% static 'images/karet.png' %}" alt="Karet" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-circle" style="display:none; font-size: 2rem; color: #34495e;"></i>
        </div>
        <div class="item-name">Karet</div>
        <div class="item-description">Ban bekas, sarung tangan karet</div>
    </div>

    <div class="item-card" data-category="non-organic" data-name="elektronik">
        <div class="item-icon">
            <img src="{% static 'images/elektronik.png' %}" alt="Elektronik" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-mobile-alt" style="display:none; font-size: 2rem; color: #f39c12;"></i>
        </div>
        <div class="item-name">Elektronik</div>
        <div class="item-description">HP bekas, komponen elektronik</div>
    </div>

    <div class="item-card" data-category="non-organic" data-name="styrofoam">
        <div class="item-icon">
            <img src="{% static 'images/styrofoam.png' %}" alt="Styrofoam" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-square" style="display:none; font-size: 2rem; color: #ecf0f1;"></i>
        </div>
        <div class="item-name">Styrofoam</div>
        <div class="item-description">Kemasan makanan, kotak styrofoam</div>
    </div>

    <div class="item-card" data-category="non-organic" data-name="mainan">
        <div class="item-icon">
            <img src="{% static 'images/mainan.png' %}" alt="Mainan" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-puzzle-piece" style="display:none; font-size: 2rem; color: #e67e22;"></i>
        </div>
        <div class="item-name">Mainan</div>
        <div class="item-description">Mainan bekas, puzzle, lego</div>
    </div>
    {% endfor %}

    <!-- Organic Items -->
    {% for waste in organic_wastes %}
    <div class="item-card" data-category="organic" data-name="{{ waste.name|lower }}">
        {% if waste.is_new %}
        <div class="item-badge new">Baru</div>
        {% endif %}
        <div class="item-icon">
            <img src="{% static 'images/'|add:waste.name|lower|add:'.png' %}" alt="{{ waste.name }}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-leaf" style="display:none; font-size: 2rem; color: #27ae60;"></i>
        </div>
        <div class="item-name">{{ waste.name }}</div>
        <div class="item-description">{{ waste.description|truncatewords:10 }}</div>
    </div>
    {% empty %}
    <!-- Default Organic Items if no data in database -->
    <div class="item-card" data-category="organic" data-name="daun">
        <div class="item-icon">
            <img src="{% static 'images/daun.png' %}" alt="Daun" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-leaf" style="display:none; font-size: 2rem; color: #27ae60;"></i>
        </div>
        <div class="item-name">Daun</div>
        <div class="item-description">Daun kering, daun gugur, daun tanaman</div>
    </div>

    <div class="item-card" data-category="organic" data-name="sisa makanan">
        <div class="item-icon">
            <img src="{% static 'images/sisa_makanan.png' %}" alt="Sisa Makanan" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-apple-alt" style="display:none; font-size: 2rem; color: #e74c3c;"></i>
        </div>
        <div class="item-name">Sisa Makanan</div>
        <div class="item-description">Nasi, sayur, lauk pauk sisa</div>
    </div>

    <div class="item-card" data-category="organic" data-name="kulit buah">
        <div class="item-icon">
            <img src="{% static 'images/kulit_buah.png' %}" alt="Kulit Buah" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-seedling" style="display:none; font-size: 2rem; color: #f39c12;"></i>
        </div>
        <div class="item-name">Kulit Buah</div>
        <div class="item-description">Kulit pisang, jeruk, apel, mangga</div>
    </div>

    <div class="item-card" data-category="organic" data-name="sayuran busuk">
        <div class="item-icon">
            <img src="{% static 'images/sayuran_busuk.png' %}" alt="Sayuran Busuk" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-carrot" style="display:none; font-size: 2rem; color: #e67e22;"></i>
        </div>
        <div class="item-name">Sayuran Busuk</div>
        <div class="item-description">Sayur layu, busuk, tidak layak konsumsi</div>
    </div>

    <div class="item-card" data-category="organic" data-name="ranting kayu">
        <div class="item-icon">
            <img src="{% static 'images/ranting_kayu.png' %}" alt="Ranting Kayu" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-tree" style="display:none; font-size: 2rem; color: #8B4513;"></i>
        </div>
        <div class="item-name">Ranting Kayu</div>
        <div class="item-description">Ranting pohon, kayu kecil, potongan bambu</div>
    </div>

    <div class="item-card" data-category="organic" data-name="sekam padi">
        <div class="item-icon">
            <img src="{% static 'images/sekam_padi.png' %}" alt="Sekam Padi" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-wheat" style="display:none; font-size: 2rem; color: #D2691E;"></i>
        </div>
        <div class="item-name">Sekam Padi</div>
        <div class="item-description">Kulit gabah, sekam hasil penggilingan</div>
    </div>

    <div class="item-card" data-category="organic" data-name="ampas teh">
        <div class="item-icon">
            <img src="{% static 'images/ampas_teh.png' %}" alt="Ampas Teh" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-mug-hot" style="display:none; font-size: 2rem; color: #654321;"></i>
        </div>
        <div class="item-name">Ampas Teh</div>
        <div class="item-description">Ampas teh celup, daun teh bekas</div>
    </div>

    <div class="item-card" data-category="organic" data-name="ampas kopi">
        <div class="item-icon">
            <img src="{% static 'images/ampas_kopi.png' %}" alt="Ampas Kopi" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-coffee" style="display:none; font-size: 2rem; color: #8B4513;"></i>
        </div>
        <div class="item-name">Ampas Kopi</div>
        <div class="item-description">Bubuk kopi bekas, ampas kopi tubruk</div>
    </div>

    <div class="item-card" data-category="organic" data-name="kulit telur">
        <div class="item-icon">
            <img src="{% static 'images/kulit_telur.png' %}" alt="Kulit Telur" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-egg" style="display:none; font-size: 2rem; color: #F5F5DC;"></i>
        </div>
        <div class="item-name">Kulit Telur</div>
        <div class="item-description">Cangkang telur ayam, bebek, puyuh</div>
    </div>

    <div class="item-card" data-category="organic" data-name="kertas tisu">
        <div class="item-icon">
            <img src="{% static 'images/kertas_tisu.png' %}" alt="Kertas Tisu" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-tissue" style="display:none; font-size: 2rem; color: #F0F8FF;"></i>
        </div>
        <div class="item-name">Kertas Tisu</div>
        <div class="item-description">Tisu bekas, serbet kertas</div>
    </div>

    <div class="item-card" data-category="organic" data-name="tulang ikan">
        <div class="item-icon">
            <img src="{% static 'images/tulang_ikan.png' %}" alt="Tulang Ikan" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-fish" style="display:none; font-size: 2rem; color: #4682B4;"></i>
        </div>
        <div class="item-name">Tulang Ikan</div>
        <div class="item-description">Tulang ikan, duri ikan, kepala ikan</div>
    </div>

    <div class="item-card" data-category="organic" data-name="bunga layu">
        <div class="item-icon">
            <img src="{% static 'images/bunga_layu.png' %}" alt="Bunga Layu" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-flower" style="display:none; font-size: 2rem; color: #FF69B4;"></i>
        </div>
        <div class="item-name">Bunga Layu</div>
        <div class="item-description">Bunga potong layu, kelopak bunga</div>
    </div>
    {% endfor %}

    <!-- Hazardous Waste Items -->
    <div class="item-card" data-category="hazardous" data-name="baterai">
        <div class="item-badge">B3</div>
        <div class="item-icon">
            <img src="{% static 'images/baterai.png' %}" alt="Baterai" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-battery-half" style="display:none; font-size: 2rem; color: #e74c3c;"></i>
        </div>
        <div class="item-name">Baterai</div>
        <div class="item-description">Baterai bekas, aki, power bank rusak</div>
    </div>

    <div class="item-card" data-category="hazardous" data-name="lampu">
        <div class="item-badge">B3</div>
        <div class="item-icon">
            <img src="{% static 'images/lampu.png' %}" alt="Lampu" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-lightbulb" style="display:none; font-size: 2rem; color: #f39c12;"></i>
        </div>
        <div class="item-name">Lampu Neon</div>
        <div class="item-description">Lampu TL, lampu hemat energi</div>
    </div>

    <div class="item-card" data-category="hazardous" data-name="obat">
        <div class="item-badge">B3</div>
        <div class="item-icon">
            <img src="{% static 'images/obat.png' %}" alt="Obat" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-pills" style="display:none; font-size: 2rem; color: #9b59b6;"></i>
        </div>
        <div class="item-name">Obat Kadaluarsa</div>
        <div class="item-description">Obat expired, vitamin kadaluarsa</div>
    </div>

    <div class="item-card" data-category="hazardous" data-name="cat">
        <div class="item-badge">B3</div>
        <div class="item-icon">
            <img src="{% static 'images/cat.png' %}" alt="Cat" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-paint-brush" style="display:none; font-size: 2rem; color: #34495e;"></i>
        </div>
        <div class="item-name">Cat & Thinner</div>
        <div class="item-description">Kaleng cat bekas, thinner, pelarut</div>
    </div>
</div>

<!-- No Results Message -->
<div class="no-results" id="noResults" style="display: none;">
    <i class="fas fa-search"></i>
    <h3>Tidak ada hasil ditemukan</h3>
    <p>Coba ubah kata kunci pencarian atau pilih kategori lain</p>
</div>

<!-- Statistics Section -->
<div class="stats-section">
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-recycle"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_contents|default:0 }}</h3>
                <p>Total Konten</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_users|default:0 }}</h3>
                <p>Pengguna Aktif</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-leaf"></i>
            </div>
            <div class="stat-content">
                <h3>{{ organic_count|default:0 }}</h3>
                <p>Sampah Organik</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-bottle-water"></i>
            </div>
            <div class="stat-content">
                <h3>{{ non_organic_count|default:0 }}</h3>
                <p>Sampah Non-Organik</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
                <h3>{{ hazardous_count|default:0 }}</h3>
                <p>Limbah B3</p>
            </div>
        </div>
    </div>
</div>

{% comment %} <!-- Filters Panel -->
<div class="filters-backdrop" id="filtersBackdrop"></div>
<div class="filters-panel" id="filtersPanel">
    <div class="filters-header">
        <h3>Filter Pencarian</h3>
        <button class="close-filters" id="closeFilters">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <div class="filter-group">
        <h4>Kategori</h4>
        <div class="filter-options">
            <div class="filter-option">
                <input type="radio" id="filter-all" name="category" value="all" checked>
                <label for="filter-all">Semua Kategori</label>
            </div>
            <div class="filter-option">
                <input type="radio" id="filter-organic" name="category" value="organic">
                <label for="filter-organic">Organik</label>
            </div>
            <div class="filter-option">
                <input type="radio" id="filter-non-organic" name="category" value="non-organic">
                <label for="filter-non-organic">Non-Organik</label>
            </div>
            <div class="filter-option">
                <input type="radio" id="filter-hazardous" name="category" value="hazardous">
                <label for="filter-hazardous">Limbah B3</label>
            </div>
        </div>
    </div>
    
    <div class="filter-group">
        <h4>Status</h4>
        <div class="filter-options">
            <div class="filter-option">
                <input type="checkbox" id="filter-new" value="new">
                <label for="filter-new">Baru</label>
            </div>
        </div>
    </div> 
    {% endcomment %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/home.js' %}"></script>
<script>
// Ensure organic items are visible by default
document.addEventListener('DOMContentLoaded', function() {
    // Show all items by default
    showAllItems();
});

function showAllItems() {
    const items = document.querySelectorAll('.item-card');
    items.forEach(item => {
        item.style.display = 'block';
    });
    
    // Update active tab
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector('[data-category="all"]').classList.add('active');
    
    checkNoResults();
}

document.addEventListener('DOMContentLoaded', function() {
    const filterBtn = document.getElementById('filterBtn');
    const filterPanel = document.getElementById('filterPanel');

    if (filterBtn) {
        filterBtn.addEventListener('click', function () {
            filterPanel.classList.toggle('hidden');
        });
    }
});

document.getElementById('searchInput').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        const keyword = this.value.toLowerCase();
        const items = document.querySelectorAll('.item-card');
        let hasResult = false;

        items.forEach(item => {
            const name = item.dataset.name;
            if (name.includes(keyword)) {
                item.style.display = 'block';
                hasResult = true;
            } else {
                item.style.display = 'none';
            }
        });

        document.getElementById('filterBtn').classList.remove('hidden');
        checkNoResults();
    }
});

document.querySelectorAll('.filter-tag').forEach(tag => {
    tag.addEventListener('click', function () {
        tag.classList.toggle('active');
        filterItems();
    });
});

function filterItems() {
    const activeFilters = document.querySelectorAll('.filter-tag.active');
    const items = document.querySelectorAll('.item-card');

    const filterValues = {
        category: [],
        material: [],
        durasi: [],
        difficulty: []
    };

    activeFilters.forEach(tag => {
        const type = tag.dataset.filterType;
        const value = tag.dataset.value;
        filterValues[type].push(value);
    });

    items.forEach(item => {
        let visible = true;

        if (filterValues.category.length > 0) {
            visible = visible && filterValues.category.includes(item.dataset.category);
        }
        if (filterValues.material.length > 0) {
            visible = visible && filterValues.material.includes(item.dataset.material);
        }
        if (filterValues.durasi.length > 0) {
            visible = visible && filterValues.durasi.includes(item.dataset.durasi);
        }
        if (filterValues.difficulty.length > 0) {
            visible = visible && filterValues.difficulty.includes(item.dataset.difficulty);
        }

        item.style.display = visible ? 'block' : 'none';
    });

    checkNoResults();
}

function toggleView() {
    const grid = document.getElementById('itemsGrid');
    grid.classList.toggle('list-view');
}

function checkNoResults() {
    const visibleItems = document.querySelectorAll('.item-card[style*="block"], .item-card:not([style*="none"])');
    const noResults = document.getElementById('noResults');
    
    if (visibleItems.length === 0) {
        noResults.style.display = 'block';
    } else {
        noResults.style.display = 'none';
    }
}
</script>
{% endblock %}